# What are resources?
The CISDSC module delivers 'composite resources' that are generated by the 'CISDSCResourceGeneration' module. The composite resources are what IT pros will use to apply the benchmarks to their machines via PowerShell DSC. In a nutshell composite resources are DSC configurations you've bundled up to be used by other DSC configurations. This allows IT pros to have have a single block in their existing configurations that handle the hundreds of CIS recommendations without creating noise. Detailed information on composite resources can be found [here](https://docs.microsoft.com/en-us/powershell/scripting/dsc/resources/authoringresourcecomposite?view=powershell-7).

It is worth noting that user settings are out of scope for these resources. CIS benchmarks give recommendations for user settings stored in the HKCU registry hive but it is not possible for DSC to interact with these values.

Example of using a composite resource:
```powershell
Configuration MyWorkstation
{
    Import-DSCResource -ModuleName 'PSDesiredStateConfiguration'
    Import-DSCResource -ModuleName 'CISDSC'

    node 'localhost'
    {
        CIS_Microsoft_Windows_10_Enterprise_Release_1909 'CIS Benchmarks'{}

        File 'Other non-DSC stuff'
        {
            DestinationPath = 'C:\random.txt'
            Contents = 'Security benchmarks are cool!'
        }
    }
}
```

# How do I create new ones?
1) Acquire the GPOs and Excel documentation from [CIS](./static_corrections.md).

2) Set up your development environment with the following PowerShell. This will clone this repository and install the dependencies specified in [build.depend.psd1](./../build.depend.psd1). Due to the dependency on [GPRegistryPolicyParser](https://www.powershellgallery.com/packages/GPRegistryPolicyParser) you will need to do this in Windows PowerShell 5.1.
```powershell
git clone https://github.com/techservicesillinois/SecOps-Powershell-CISDSC
Set-Location -Path '.\SecOps-Powershell-CISDSC'
Install-Module -Name 'PSDepend'
Invoke-PSDepend -Force
```

3) The following example will generate a new DSC composite resource. You will need to edit the parameters accordingly.
```powershell
Import-Module '.\src\CISDSCResourceGeneration\CISDSCResourceGeneration.psd1' -Force
$Splat = @{
    BenchmarkPath = 'C:\CIS_Microsoft_Windows_10_Enterprise_Release_1909_Benchmark_v1.8.1.xlsx'
    BenchmarkVersion = '1.8.1'
    GPOPath = 'C:\Windows10v1.8.0'
    OutputPath = '.\src\CISDSC\dscresources'
    StaticCorrectionsPath = '.\static_corrections.csv'
    ParameterValidationsPath = '.\parameter_validations.csv'
    ParameterOverridesPath = '.\parameter_overrides.csv'
    OS = 'Microsoft Windows 10 Enterprise'
    OSBuild = '1909'
}
ConvertTo-DSC @Splat
```
Successfully generated resources will be placed into the generated composite resource however some settings have been known to link between the GPOs and Excel document cleanly.

4) Resolve errors identified in the previous step. Potential causes and resolutions are outlined in the [static corrections](./static_corrections.md) documentation.

5) Verify the appropriate validation for generated parameters via MS documentation or otherwise and implement them according to the [parameter documentation](./resource_parameters.md#How-can-I-add-validation-blocks?)

6) If applicable specify any [parameter overrides](./resource_parameters.md#Can-these-be-overridden?) to add/remove any parameters.

7) Regenerate your resource after completing the previous two steps.

8) Verify your results with the [CIS-CAT](https://workbench.cisecurity.org/files/2151) assessment tool available from the [CIS workbench](https://workbench.cisecurity.org/). A HTML report from the tool will be required later for pull request approval. Documentation for the tool can be found [here](https://ccpa-docs.readthedocs.io/en/latest/User%20Guide%20for%20CLI/).


# How do I add or update them within the module?
1) For additions the DscResourcesToExport field of the [module manifest](./../src/CISDSC/CISDSC.psd1) should be updated with the new resource.

2) An example of how to use the resource should be placed in the [examples directory](./../src/CISDSC/Examples/).

3) Document what was added or updated in the [changelog](./../CHANGELOG.md).

4) Submit a pull request with an attached HTML report from the CIS-CAT assessment tool.