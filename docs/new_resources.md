# What are resources?
The CISDSC module delivers 'composite resources' that are generated by the 'CISDSCResourceGeneration' module. The composite resources are what IT pros will use to apply the benchmarks to their machines via PowerShell DSC. In a nutshell composite resources are DSC configurations you've bundled up to be used by other DSC configurations. This allows IT pros to have have a single block in their existing configurations that handle the hundreds of CIS recommendations without creating noise. Detailed information on composite resources can be found [here](https://docs.microsoft.com/en-us/powershell/scripting/dsc/resources/authoringresourcecomposite?view=powershell-7).

It is worth noting that user settings are out of scope for these resources. CIS benchmarks give recommendations for user settings stored in the HKCU registry hive but it is not possible for DSC to interact with these values.

Example of using a composite resource:
```powershell
Configuration MyWorkstation
{
    Import-DSCResource -ModuleName 'PSDesiredStateConfiguration'
    Import-DSCResource -ModuleName 'CISDSC'

    node 'localhost'
    {
        CIS_Microsoft_Windows_10_Enterprise_Release_1909 'CIS Benchmarks'{}

        File 'Other non-DSC stuff'
        {
            DestinationPath = 'C:\random.txt'
            Contents = 'Security benchmarks are cool!'
        }
    }
}
```

# How do I create new ones?

1) Acquire the GPOs and Excel documentation from [CIS](./static_corrections.md).

> The GPOs may be provided zipped.

2) Set up your development environment with the following PowerShell. This will clone this repository and install the dependencies specified in [install_dependencies](/tools/install_dependencies.ps1).

```powershell
git clone https://github.com/techservicesillinois/SecOps-Powershell-CISDSC
Set-Location -Path '.\SecOps-Powershell-CISDSC'
# This command requires administrator privileges:
.\tools\install_dependencies.ps1
```

3) Compare the new Excel document with the previously available using [find_changed_recommendations.ps1](/tools/find_changed_recommendations.ps1) to see if there is any drift in recommendation numbers that would impact the CSVs mentioned later in the process.

```powershell
> Set-Location -Path '.\SecOps-Powershell-CISDSC\tools'
> .\find_changed_recommendations.ps1 -PreviousPath "C:\temp\cis\CIS_Microsoft_Windows_Server_2019_Benchmark_v1.3.0.xlsx" -NewPath "C:\temp\cis\CIS_Microsoft_Windows_Server_2022_Benchmark_v1.0.0.xlsx" -System "Member Server"

Name                                                                                      OldNumber     NewNumber
----                                                                                      ---------     ---------
(L1) Ensure 'Do not allow drive redirection' is set to 'Enabled'                          18.9.65.3.3.2 18.9.65.3.3.3
(L2) Ensure 'Do not allow COM port redirection' is set to 'Enabled'                       18.9.65.3.3.1 18.9.65.3.3.2
(L2) Ensure 'Do not allow LPT port redirection' is set to 'Enabled'                       18.9.65.3.3.3 18.9.65.3.3.5
(L2) Ensure 'Do not allow supported Plug and Play device redirection' is set to 'Enabled' 18.9.65.3.3.4 18.9.65.3.3.6
```

4) The following examples will generate a new DSC composite resource for OS and a browser respectively. You will need to edit the parameters accordingly. These are also available in [generate_resources.ps1](/tools/generate_resources.ps1). After they are generated you will need to copy the output files to their appropriate location inside the CISDSC directory.
## Operating System
```powershell
Import-Module '.\src\CISDSCResourceGeneration\CISDSCResourceGeneration.psd1' -Force
$Splat = @{
    BenchmarkPath = 'C:\CIS_Microsoft_Windows_10_Enterprise_Release_1909_Benchmark_v1.8.1.xlsx'
    BenchmarkVersion = '1.8.1'
    GPOPath = 'C:\Windows10v1.8.0'
    OutputPath = '.\src\CISDSC\dscresources'
    StaticCorrectionsPath = '.\static_corrections.csv'
    ParameterValidationsPath = '.\parameter_validations.csv'
    ParameterOverridesPath = '.\parameter_overrides.csv'
    OS = 'Microsoft Windows 10 Enterprise'
    OSBuild = '1909'
}
ConvertTo-DSC @Splat
```

## Web Browser
```powershell
Import-Module '.\src\CISDSCResourceGeneration\CISDSCResourceGeneration.psd1' -Force
$Splat = @{
    BenchmarkPath = 'C:\CIS_Microsoft_Edge_Benchmark_v1.0.0_Certification.xlsx'
    BenchmarkVersion = '1.0.0'
    GPOPath = 'C:\MicrosoftEdgeV1.0.0'
    OutputPath = '.\src\CISDSC\dscresources'
    StaticCorrectionsPath = '.\static_corrections.csv'
    ParameterValidationsPath = '.\parameter_validations.csv'
    ParameterOverridesPath = '.\parameter_overrides.csv'
    Browser = 'Microsoft Edge'
}
ConvertTo-DSC @Splat
```

Successfully generated resources will be placed into the generated composite resource however some settings have been known to link between the GPOs and Excel document cleanly.

1) Resolve errors identified in the previous step. Potential causes and resolutions are outlined in the [static corrections](./static_corrections.md) documentation.

2) Verify the appropriate validation for generated parameters via MS documentation or otherwise and implement them according to the [parameter documentation](./resource_parameters.md#How-can-I-add-validation-blocks?)

3) If applicable specify any [parameter overrides](./resource_parameters.md#Can-these-be-overridden?) to add/remove any parameters.

4) Regenerate your resource after completing the previous two steps.

5) Verify your results with the [CIS-CAT](cis.md#CISCAT).
```cmd
Assessor-CLI.bat -i -html
```


# How do I add or update them within the module?
1) For additions the DscResourcesToExport field of the [module manifest](./../src/CISDSC/CISDSC.psd1) should be updated with the new resource.

2) An example of how to use the resource should be placed in the [examples directory](./../src/CISDSC/Examples/).

3) Document what was added or updated in the [changelog](./../CHANGELOG.md).

4) Submit a pull request with an attached HTML report from the CIS-CAT assessment tool.
